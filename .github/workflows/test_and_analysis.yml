name: Test and Static Analysis

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '20'
      - name: Install dependencies
        run: npm ci
      - name: Run tests
        run: npm test

  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '20'
      - name: Install dependencies
        run: npm ci
      - name: Run lint
        run: npx eslint .

  codebase_digest:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Run Codebase Digest
        run: |
          # Example command to run Codebase-Digest
          npx codebase-digest --output-file=report.md
      - name: Upload Codebase Digest Report
        uses: actions/upload-artifact@v4
        with:
          name: codebase-digest-report
          path: report.md

  ai_code_review:
    needs: lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Run AI Code Review
        run: |
          # Example command to run AI Code Review tool
          npx ai-code-review --output-file=review_comments.json
      - name: Upload AI Code Review Report
        uses: actions/upload-artifact@v4
        with:
          name: ai-review-report
          path: review_comments.json
