# AGENTS Instructions

Guidelines for working in this repository.

## Commit Policy

- Develop on feature branches and keep commits atomic.
- Use [Conventional Commits](https://www.conventionalcommits.org/).
- Avoid committing generated artifacts: `ios/Pods/`, any `*.xcworkspace`, `DerivedData/`, or `*.xcfilelist`.

## Testing & Quality

Before committing, run:

```bash
npm test
(test -f eslint.config.mjs && npm run lint)
npm run format:check
```

Add or update tests for new code.

## Toolchain

- Node **20**, Ruby **3.2**, Bundler.
- iOS target **monGARS** with deployment target **18.0**.
- Build using **Xcode 16.4** (iOS 18.5 SDK). CI runs on **macos-15**.
- Workspace generated by CocoaPods: `ios/monGARS.xcworkspace`.

## iOS Build Steps

```bash
npm ci
(cd ios && xcodegen generate && bundle install && bundle exec pod install --repo-update)
./scripts/ios_doctor.sh
npx react-native run-ios --scheme monGARS
```

You can also build with `xcodebuild` using the workspace and scheme above.

## Codegen

- Specs live in `src/specs/`.
- After changing specs run `npm run codegen` and `bundle exec pod install --repo-update`.

## TurboModules

- Implement modules Swift‑first: TypeScript spec → Swift class → small `.mm` glue file.
- JS must use `TurboModuleRegistry.getOptional('Name')` with fallback to legacy modules (`MLXModule` on iOS, `LlamaTurboModule` on Android).

## Logging & Debugging

- Enable file logging with `DEBUG_LOGGING=1` (via `react-native-config`). Logs appear under `logs/app.log`.
- Open the in‑app Debug Console (`DEBUG_PANEL=1`) to view or clear logs.

## CI Notes

- Node cache key: `hashFiles('package-lock.json')`.
- Pods cache key: `hashFiles('ios/Podfile.lock')` + `XCODE_VERSION`.
- CI generates reports in `reports/` (`report_agent.md`, `REPORT.md`, etc.). Do not edit these files manually; regenerate them with the provided npm scripts.
